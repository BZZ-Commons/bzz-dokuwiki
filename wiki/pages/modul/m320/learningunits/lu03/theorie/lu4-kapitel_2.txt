===== 90. Python-Exceptions (alt) =====

==== Inhalt ====

  * Ausnahmen versus Syntaxfehler
  * Der ''%%try...except%%'' Block: Umgang mit Ausnahmen
  * Die ''%%else%%'' Klausel
  * AufrÃ¤umen nach der ''%%finally%%'' Verwendung
  * AuslÃ¶sen einer Ausnahme
  * Bedingungen sicherstellen
  * Zusammenfassung

Ein Python-Programm wird beendet, sobald es auf einen Fehler stÃ¶sst.Â In Python kann ein Fehler ein Syntaxfehler oder eine Ausnahme sein.Â In diesem Artikel erfahren Sie, was eine Ausnahme ist und wie sie sich von einem Syntaxfehler unterscheidet. Danach erfahren Sie, wie Sie Ausnahmen auslÃ¶sen und Zusicherungen aufstellen.Â Dann werden Sie mit einer Demonstration des ''%%try...except%%'' Blocks abschliessen.

{{:modul:m320:learningunits:lu04:theorie:exceptions.png?nolink&600|Python Exceptions}}

==== Ausnahmen versus Syntaxfehler ====

[[https://realpython.com/invalid-syntax-python/|Syntaxfehler]]Â treten auf, wenn der Parser eine falsche Anweisung erkennt.Â Beachten Sie folgendes Beispiel:

<code terminal>
>>> print( 0 / 0 ))
  File "<stdin>", line 1
    print( 0 / 0 ))
                  ^
SyntaxError: invalid syntax
</code>

Der Pfeil zeigt an, wo der Parser auf denÂ **Syntaxfehler**Â gestossen ist.Â In diesem Beispiel war eine Klammer zu viel.Â Entfernen Sie diese und fÃ¼hren Sie Ihren Code erneut aus:

<code terminal>
>>> print( 0 / 0 )
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: integer division or modulo by zero
</code>

Dieses Mal ist einÂ **Ausnahmefehler** aufgetreten.Â Dieser Fehlertyp tritt immer dann auf, wenn syntaktisch korrekter Python-Code zu einem Fehler fÃ¼hrt.Â Die letzte Zeile der Meldung gibt an, auf welche Art von Ausnahmefehler Sie gestossen sind.

Anders als beim Syntaxfehler gibt Python an, welche Art von Ausnahmefehler aufgetreten ist.Â In diesem Fall war es einÂ ''%%ZeroDivisionError%%''.Â Python verfÃ¼gt Ã¼berÂ [[https://docs.python.org/3/library/exceptions.html|verschiedene eingebaute Ausnahmen]]Â sowie die MÃ¶glichkeit, selbst definierte Ausnahmen zu erstellen.

==== DerÂ try...except Block: Umgang mit Ausnahmen ====

DerÂ ''%%try...except%%'' Block in Python wird zum Abfangen und Behandeln von Ausnahmen verwendet.Â Python fÃ¼hrt Code nach derÂ ''%%try%%'' Anweisung als â€normalenâ€œ Teil des Programms aus.Â Der Code, der derÂ ''%%except%%'' Anweisung folgt, ist die Antwort des Programms auf alle Ausnahmen in der vorhergehendenÂ ''%%try%%'' Klausel.

{{:modul:m320:learningunits:lu04:theorie:try...except.png?nolink&600|DerÂ try...except Block: Umgang mit Ausnahmen}}

Wie Sie bereits gesehen haben, gibt Python einen Ausnahmefehler aus, wenn syntaktisch korrekter Code auf einen Fehler stÃ¶sst.Â Dieser Ausnahmefehler fÃ¼hrt zum Absturz des Programms, wenn er nicht behandelt wird.Â DieÂ ''%%except%%'' Klausel bestimmt, wie Ihr Programm auf Ausnahmen reagiert.

Die folgende Funktion kann Ihnen helfen, denÂ ''%%try...except%%'' Block zu verstehen:

<code python>
def process_orders(quantity: int):
    ifÂ quantity <Â 100:
        # hier wird ein Fehler erkannt und das passende Fehlerobjekt - im Beispiel ProcessingError - erzeugt
        raise ProcessingError("Not enough orders to start processing.")
    else:
        print('Processing orders.')
</code>

Die FunktionÂ ''%%process_orders()%%'' kann nur erfolgreich mit Werten grÃ¶sser oder gleich 100 ausgefÃ¼hrt werden.Â Andernfalls lÃ¶stÂ ''%%raise%%'' in dieser Funktion eineÂ ''%%ProcessingError%%'' Exception aus.

MitÂ ''%%try%%'' kÃ¶nnen Sie dennoch einen Versuch wagen, die Funktion aufzurufen:

<code python>
try:
    process_orders(99)
except:
    pass
</code>

Der Fehler wird hier mitÂ ''%%pass%%'' behandelt.Â Wenn Sie diesen Code ausfÃ¼hren wÃ¼rden, erhalten Sie die folgende Ausgabe:

<code terminal>

</code>

Nichts.Â Das Gute dabei ist, dass das Programm nicht abgestÃ¼rzt ist.Â Aber es wÃ¤re schÃ¶n zu sehen, ob bei der AusfÃ¼hrung Ihres Codes eine Ausnahme aufgetreten ist.Â Zu diesem Zweck kÃ¶nnen Sie ''%%pass%%'' wie folgt durch die Ausgabe einer Nachricht ersetzen:

<code python>
try:
    process_orders(99)
except:
    print('Function was not executed')
</code>

FÃ¼hren Sie diesen Code aus:

<code terminal>
Function was not executed
</code>

Wenn in einem Programm, das diese Funktion ausfÃ¼hrt, eine Ausnahme auftritt, wird das Programm fortfahren und Sie darÃ¼ber informieren, dass der Funktionsaufruf nicht erfolgreich war.

Was Sie nicht gesehen haben, war die Art des Fehlers, der als Ergebnis des Funktionsaufrufs ausgelÃ¶st wurde.Â Um genau zu sehen, was schief gelaufen ist, mÃ¼ssten Sie den Fehler abfangen, den die Funktion ausgelÃ¶st hat.

Der folgende Code ist ein Beispiel, in dem Sie die Nachricht aus dem ''ProcessingError'' extrahieren und auf dem Bildschirm ausgeben:

<code python>
try:
    process_orders(99)
except ProcessingError as error:
    print(error)
    print('Function was not executed')
</code>

Folgendes wird ausgegeben:

<code terminal>
Not enough orders to start processing.
Function was not executed
</code>

Die erste Meldung ist derÂ ''ProcessingError''.Â Die zweite Meldung gibt an, dass die Funktion nicht ausgefÃ¼hrt wurde.

Im vorherigen Beispiel haben Sie eine selbst geschriebene Funktion aufgerufen.Â Als Sie die Funktion ausgefÃ¼hrt haben, haben Sie dieÂ ''ProcessingError'' Ausnahme abgefangen und auf dem Bildschirm ausgegeben.

Hier ist ein weiteres Beispiel, in dem Sie eine Datei Ã¶ffnen und dabei auf Exceptions prÃ¼fen:

<code python>
try:
    with open('file.log') as file:
        read_data = file.read()
except:
    print('Could not open file.log')
</code>

WennÂ //file.log//Â nicht vorhanden ist, gibt dieser Codeblock folgendes aus:

<code terminal>
Could not open file.log
</code>

Dies ist eine informative Nachricht, und unser Programm wird weiterhin ausgefÃ¼hrt.Â In derÂ [[https://docs.python.org/3/library/exceptions.html|Python-Dokumentation]]Â kÃ¶nnen Sie sehen, dass Python viele sog. //Built-in Exceptions// anbietet, die Sie verwenden kÃ¶nnen.Â Eine auf dieser Seite beschriebene Ausnahme ist diese:

> Ausnahme ''%%FileNotFoundError%%''
>
> Wird ausgelÃ¶st, wenn eine Datei oder ein Verzeichnis angefordert wird, aber nicht vorhanden ist.Â Entspricht ''errno ENOENT''.

Um diese Art von Ausnahme abzufangen und auf dem Bildschirm auszugeben, kÃ¶nnen Sie den folgenden Code verwenden:

<code python>
try:
    with open('file.log') as file:
        read_data = file.read()
except FileNotFoundError as fnf_error:
    print(fnf_error)
</code>

Wenn in diesem FallÂ //file.log//Â nicht vorhanden ist, lautet die Ausgabe wie folgt:

<code terminal>
[Errno 2] No such file or directory: 'file.log'
</code>

Sie kÃ¶nnen mehr als einen Funktionsaufruf in IhrerÂ ''%%try%%'' Klausel haben und sollten damit rechnen, verschiedene Ausnahmen abzufangen.Â Hier ist zu beachten, dass der Code in derÂ ''%%try%%'' Klausel beendet wird, sobald eine Ausnahme auftritt.

<WRAP important 100%>
**Warnung:**Â CatchingÂ ''%%Exception%%'' verbirgt alle Fehler â€¦ auch die vÃ¶llig unerwarteten.Â Aus diesem Grund sollten SieÂ in Ihren Python-Programmen allgemeine ÃœberprÃ¼fungen auf ''%%Exception%%'' vermeiden und stattdessen spezifische AusnahmeklassenÂ verwenden, dieÂ Sie einzeln abfangen und behandeln.Â [[https://realpython.com/the-most-diabolical-python-antipattern/|In diesem Tutorial]]Â erfahren Sie mehr darÃ¼ber, warum dies eine gute Idee ist.
</WRAP>

Hier sind die wichtigsten Erkenntnisse:

  * EineÂ ''%%try%%'' Klausel wird bis zu dem Punkt ausgefÃ¼hrt, an dem die erste Ausnahme auftritt.
  * Innerhalb derÂ ''%%except%%'' Klausel bestimmen Sie, wie das Programm auf die Ausnahme reagiert.
  * Dabei kÃ¶nnen Sie verschiedene Ausnahmen prÃ¼fen und jeweils anders darauf reagieren, so wie es erforderlich ist.
  * Verwenden Sie keine leeren ''%%except%%'' BlÃ¶cke und benennen Sie die erwarteten und behandelten Ausnahmen konkret!

==== DieÂ else Klausel ====

In Python kÃ¶nnenÂ Sie mit der ''%%else%%''-Anweisung ein Programm anweisen, einen bestimmten Codeblock nur ohne Ausnahmen auszufÃ¼hren.

{{:modul:m320:learningunits:lu04:theorie:else.png?nolink&600|DieÂ else Klausel}}

Sehen Sie sich das folgende Beispiel an:

<code python>
try:
    process_orders()
except ProcessingError as error:
    print(error)
else:
    print('Executing the else clause.')
</code>

Wenn Sie diesen Code ausfÃ¼hren und kein Fehler auftritt, wÃ¼rde die Ausgabe wie folgt aussehen:

<code terminal>
Doing something. Executing the else clause.
</code>

Da das Programm auf keine Ausnahmen gestossen ist,Â wurde die ''%%else%%'' Klausel ausgefÃ¼hrt.

Sie kÃ¶nnen auchÂ ''%%try%%'' Code innerhalb derÂ ''%%else%%'' Klausel ausfÃ¼hren und dort auch mÃ¶gliche Ausnahmen abfangen:

<code python>
try:
    process_orders()
except ProcessingError as error:
    print(error)
else:
    try:
        with open('file.log') as file:
            read_data = file.read()
    except FileNotFoundError as fnf_error:
        print(fnf_error)
</code>

Wenn die Datei nicht gelesen werden kann, wÃ¼rden Sie das folgende Ergebnis erhalten:

<code terminal>
Doing something.
[Errno 2] No such file or directory: 'file.log'
</code>

Aus der Ausgabe kÃ¶nnen Sie sehen, dass dieÂ ''%%process_orders()%%'' Funktion ausgefÃ¼hrt wurde.Â Da keine Ausnahmen aufgetreten sind, wurde versucht,Â //file.log//Â zu Ã¶ffnen.Â Diese Datei war nicht vorhanden und, anstatt die Datei zu Ã¶ffnen, haben Sie dieÂ ''%%FileNotFoundError%%'' Ausnahme abgefangen.

==== AufrÃ¤umen nach der finally Verwendung ====

Stellen Sie sich vor, Sie mÃ¼ssten nach der AusfÃ¼hrung Ihres Codes immer eine Aktion zum AufrÃ¤umen implementieren.Â Python ermÃ¶glicht Ihnen dies mit derÂ ''%%finally%%'' Klausel.

{{:modul:m320:learningunits:lu04:theorie:finally.png?nolink&600|AufrÃ¤umen nach der finally Verwendung}}

Sehen Sie sich das folgende Beispiel an:

<code python>
try:
    process_orders()
except ProcessingError as error:
    print(error)
else:
    try:
        with open('file.log') as file:
            read_data = file.read()
    except FileNotFoundError as fnf_error:
        print(fnf_error)
finally:
    print('Cleaning up, irrespective of any exceptions.')
</code>

DieÂ ''%%finally%%'' Klausel wird immer ausgefÃ¼hrt.Â Dabei spielt es keine Rolle, ob Sie irgendwo in denÂ ''%%try%%'' oderÂ ''%%else%%'' Klauseln auf eine Ausnahme stossen.Â Das Unter der Annahme, dass beim Verarbeiten der Bestellungen ein Fehler auftritt, wÃ¼rde folgendes ausgegeben:

<code terminal>
Processing Error occured.
Cleaning up, irrespective of any exceptions.
</code>

==== AuslÃ¶sen einer Ausnahme ====

Falls eine bestimmte Bedingung eintritt, kÃ¶nnen Sie mit ''%%raise%%'' eine Ausnahme auslÃ¶sen.Â Die Anweisung kann durch eine benutzerdefinierte Ausnahme ergÃ¤nzt werden.

{{:modul:m320:learningunits:lu04:theorie:raise.png?nolink&600|Ausnahmen auslÃ¶sen}}

Um einen Fehler zu werfen, kÃ¶nnen Sie folgendes tun:

<code python>
x = 10
if x > 5:
    raise Exception(f"x should not exceed 5. The value of x was: {x}")
</code>

Wenn Sie den Code ausfÃ¼hren, erhalten Sie folgende Ausgabe:

<code terminal>
Traceback (most recent call last):
  File "<input>", line 4, in <module>
Exception: x should not exceed 5. The value of x was: 10
</code>

Das Programm hÃ¤lt an und prÃ¤sentiert unsere Ausnahme auf dem Bildschirm, zusammen mit Hinweisen darÃ¼ber, was schief gelaufen ist.

==== Bedingungen sicherstellen ====

MitÂ ''%%assert%%'' stellen Sie sicher, dass eine bestimmte Bedingung erfÃ¼llt ist.Â Wenn sich herausstellt, dass dieser Zustand ''%%True%%'' ist, dann ist das ausgezeichnet!Â Das Programm kann fortgesetzt werden.Â Wenn sich herausstellt, dass die BedingungÂ ''%%False%%'' lautet, wirde eineÂ ''%%AssertionError%%'' Ausnahme ausgelÃ¶st und das Programm beendet.

{{:modul:m320:learningunits:lu04:theorie:assert.png?nolink&600|DieÂ AssertionError Ausnahme}}

Schauen Sie sich das folgende Beispiel an:

<code python>
x =Â -1  
  
#if condition returns False, AssertionError is raised:  
assertÂ x >=Â 0,Â "The value x should be positive."
</code>

Wenn Sie diesen Code ausfÃ¼hren, ist das Ergebnis der AssertionÂ ''%%False%%'' und angezeigt wird:

<code terminal>
Traceback (most recent call last):  
Â Â File "<input>", line 4, in <module>  
Â Â Â Â assert x >= 0, "The value x should be positive."
AssertionError: The value x should be positive.
</code>

In diesem Beispiel ist das AuslÃ¶sen einerÂ ''%%AssertionError%%'' Ausnahme das Letzte, was das Programm tun wird.Â Das Programm wird beendet.

<WRAP center important 100%>
**Achtung:** ''assert'' ist in Python dazu gedacht, um //wÃ¤hrend der Entwicklungsphase// sicherzustellen, dass gewisse Erwartungen erfÃ¼llt werden (z.B. dass Funktionen vernÃ¼nftige Werte zurÃ¼ckgeben). Dabei ist darauf zu achten, dass ein ''assert'' frÃ¼hzeitig fehlschlÃ¤gt (an der Stelle, an der der Fehler erkannt wurde). Daher sind ''AssertErrors'' nicht dazu gedacht, programmgesteuert erfasst oder behandelt zu werden mit ''try...except''. Am besten verwenden Sie ''assert'' Ã¼berhaupt //nicht in produktivem Code//, sondern ausschliesslich in Unit Tests ğŸ˜‰
</WRAP>

==== Zusammenfassung ====

Nachdem Sie den Unterschied zwischen Syntaxfehlern und Ausnahmen gesehen haben, haben Sie verschiedene MÃ¶glichkeiten zum AuslÃ¶sen, Abfangen und Behandeln von Ausnahmen in Python kennengelernt und gesehen wie man die folgenden SchlÃ¼sselwÃ¶rter verwendet:

  * In derÂ ''%%try%%'' Klausel werden alle Anweisungen ausgefÃ¼hrt, bis eine Ausnahme auftritt.
  * ''%%except%%'' wird verwendet, um die in der try-Klausel auftretenden Ausnahmen abzufangen und zu behandeln.
  * ''%%else%%'' lÃ¤sst Sie Abschnitte codieren, die nur ausgefÃ¼hrt werden sollen, wenn in der try-Klausel keine Ausnahmen auftreten.
  * ''%%finally%%'' ermÃ¶glicht es Ihnen, Codeabschnitte auszufÃ¼hren, die immer ausgefÃ¼hrt werden sollten, mit oder ohne zuvor aufgetretene Ausnahmen.
  * ''%%raise%%'' ermÃ¶glicht es Ihnen, jederzeit eine Ausnahme auszulÃ¶sen.
  * Mit ''%%assert%%'' kÃ¶nnen Sie Ã¼berprÃ¼fen, ob eine bestimmte Bedingung erfÃ¼llt ist, und mit einer Ausnahme das Programm beenden, sollte dies nicht der Fall sein. Empfehlung: ''assert'' am besten Ã¼berhaupt **nicht im produktiven Code verwenden!**

Hoffentlich hat Ihnen dieser Artikel geholfen, die grundlegenden Tools zu verstehen, die Python beim Umgang mit Ausnahmen zu bieten hat.

----
**Credits**: Der Inhalt dieses Artikels wurde grÃ¶sstenteils direkt aus dem Englischen Ã¼bernommen und nur leicht modifiziert. Das Original wurde hauptsÃ¤chlich von [[https://realpython.com/team/svdklundert/|Said van de Klundert]] verfasst und via [[https://realpython.com/python-exceptions/|Real Python]] verÃ¶ffentlich.
